\documentclass[french]{article}

\usepackage{tikz}
\usepackage{MyPack2}
\geometry{top=2cm, bottom=2cm, left=2cm, right=2cm}
\title{\bsc{SIG} 1}
\author{Binôme A11 \\ \bsc{Simon} Léo, \bsc{Levy--Falk} Hugo}
\date{\today}

\begin{document}
\maketitle

\tableofcontents
\listoffigures
\newpage

\initPage{TL - SIG1}{\today}{\bsc{Simon}, \bsc{Levy--Falk}}

\part{Opérations de base sur les signaux}

\section{Signal numérique de synthèse}

Notre objectif  est de définir quelques fonctions de calcul de base sur les signaux afin de découvrir les outils de Matlab.

\subsection{Génération du signal}

Tout d'abord, nous avons cherché à générer un signal sinusoïdal et à l'échantillonner avant de tracer son graphe. Après avoir effectué quelques tracés, nous avons également pu mettre en évidence le théorème de Niquist-Shannon. La figure \ref{signalSin} montre le résultat obtenu pour une fréquence d'échantillonage de 50 Hz, une fréquence de 4 Hz et N=25.

\begin{figure}[h!]
\centering
\includegraphics{images/signalSinus.eps}
\caption{Signal sinusoïdal généré.}
\label{signalSin}
\end{figure}

\subsection{ Énergie et puissance}

Dans le but de calculer l'énergie d'un signal sans utiliser \verb`for`, nous avons effectué un produit terme à terme et utilisé l'outil \verb`sum`. Une manière encore plus efficace de procéder aurait été de réaliser le produit entre le vecteur donné en entrée et sa transposée. Nous avons ensuite calculé la puissance moyenne de manière théorique, en utilisant l'identité :

\begin{equation}
\sin^2(x)=\frac {1-\cos(2x)} {2}
\end{equation}

on obtient
\begin{equation}
\frac{1} {2 \pi} \int_{0}^{2 \pi} \sin^2(x) \mathrm{d}x = \frac{1}{2}
\end{equation}

Par ailleurs, nous avons estimé la puissance de notre signal en utilisant la fonction puissance qui effectue la somme du produit terme à terme du signal et divise par la longueur de ce signal.

\lstset{language=matlab}
\begin{lstlisting}
>> s = sig1_sinus(4, 50, 2*50/4);
>> puissance(s)

ans =

    0.5000
\end{lstlisting}

On obtient un résultat conforme au calcul réalisé.

\subsection{ Quantification}

Pour quantifier un signal sur N bits, on commence par le centrer en 0 et le borner entre -0.5 et 0.5 à l'aide d'une première homothétie. Soit $s_1$ le signal ainsi obtenu. On réalise ensuite la quantification. Si $N > 0$ est le nombre de bit de quantification, on pose $q=\frac{1}{2^N}$. Dans un premier temps, on pose $s_2$ tel que :
\begin{equation}
  s_2[k] = (\lfloor \frac{s_1[k]}{q} \rfloor + \frac{1}{2}) \times q
\end{equation}

Cependant cette formule est problématique pour la valeur maximale atteinte par la fonction. En effet, on a alors :
\begin{eqnarray}
s_2[k] &=& \left( \lfloor \frac{1}{2q} \rfloor + \frac{1}{2}\right) \times q \\
&=& \left(2^{N-1} + \frac{1}{2}\right) \times \frac{1}{2^N} \\
&>& \frac{1}{2}
\end{eqnarray}

Ce qui est incohérent avec le signal original. Une solution est de poser :
\begin{equation}
  s_2[k] = \min\left(\left[\lfloor \frac{s_1[k]}{q} \rfloor + \frac{1}{2}\right] \times q, \frac{1}{2} - \frac{q}{2}\right)
\end{equation}

Il ne reste plus qu'à remettre la fonction à l'échelle. On obtient le code suivant :

\lstset{language=matlab}
\begin{lstlisting}
function sig_quant = quantifie(X, n_bit)
    m = min(X);
    M = max(X);
    c = (m+M)/2;
    d = M-m;
    q = 1 / (2 ^ n_bit);
    s1 = (X - c)/d;
    sig_quant = min((floor(s1/q) + 1/2) * q, 1/2-q/2)*d + c;
end
\end{lstlisting}
En appliquant la fonction \verb`quantifie` pour $N=3$ et $N=8$ à un signal généré grâce à la fonction écrite dans la partie 1, on obtient la figure \ref{signalBruit}. On peut noter qu'il est difficile de différencier le signal d'entrée du signal quantifié sur 8 bits. La figure \ref{signalBruit2} montre offre un zoom qui permet de différencier le signal de la quantification.

\begin{figure}[h!]
\centering
\includegraphics{images/signalBruit.eps}
\caption{Quantification du signal sinusoïdal généré.}
\label{signalBruit}
\end{figure}
\begin{figure}[h!]
	\centering
	\includegraphics{images/signalBruit1.eps}
	\caption{Quantification du signal sinusoïdal généré - zoom.}
	\label{signalBruit2}
\end{figure}

%\FloatBarrier

Pour déterminer le bruit de quantification, on calcule la différence entre le signal d'origine et le signal quantifié, et on en détermine l'énergie. On calcule également la valeur théorique du bruit de quantification. On obtient

\begin{itemize}
	\item pour 8 bits, $4.6464 \times 10^{-6}$, pour une valeur théorique de $1.272 \times 10^{-6}$;
	\item pour 3 bits, $0.0063$, pour une valeur théorique de $0.0013$.
\end{itemize}
% TODO: SIGNAL SUR BRUIT
On remarque que l'échantillonnage à 8 bits est bien plus efficace, bien que la valeur théorique soit plus faible que celle calculée.

\section{ Signal audio}

\subsection{ Restitution}

En écoutant le signal enregistré à différentes fréquences de restitutions, on remarque que augmenter cette fréquence diminue la durée de la restitution et décale les fréquences de l'enregistrement vers des fréquences plus hautes. Inversement, diminuer la fréquence de restitution augmente la durée de l'enregistrement tout en déplaçant les fréquences des sons de l'enregistrement vers les graves.

\subsection{ Quantification}

A l'aide de la fonction \verb`quantifie` réalisée dans la partie précédente, on réalise la quantification du signal enregistré. On observe que plus le nombre de bits de quantification est faible, plus le bruit (à l'écoute) est important.

Les figures \ref{sonQuantifie1} et \ref{sonQuantifie2} donnent une représentation graphiques de différentes quantification du signal vocal.

\begin{figure}[!h]
\centering
\includegraphics[height=0.45\textheight]{images/sonQuantifie2.eps}
\caption{Quantification du signal vocal enregistré.}
\label{sonQuantifie1}
\end{figure}

\begin{figure}[!h]
\centering
\includegraphics[height=0.45\textheight]{images/sonQuantifie.eps}
\caption{Quantification du signal vocal enregistré - comparaison en zoom.}
\label{sonQuantifie2}
\end{figure}

\FloatBarrier
\newpage
\part{ Classification des signaux}

Le but de cette partie est de classifier les signaux, notamment en utilisant l'autocorrélation.

\section{ Exemple de calcul théorique}

Pour le signal $y(t) = A \sin(2 \pi f t)$, calculons l'autocorrélation :

\begin{eqnarray}
\gamma_y(\tau) &=& \int_0^{\frac{1}{f}} A^2 \sin(2\pi f t) \sin(2 \pi f (t+\tau)) dt \\
&=& \frac{A^2}{2} \cos 2\pi f \tau - \frac{A^2}{2}\underbrace{\int_0^{\frac{1}{f}} \cos (2 \pi f (2t + \tau)) dt}_{=0}
\end{eqnarray}

On obtient la fonction d'autocorrélation suivante :
\begin{equation}
\gamma_y (t) = \frac{A^2} {2} cos(2 \pi f t)
\end{equation}

\section{ Programmation}

On implémente l'autocorrélation avec la formule suivante :

\begin{equation}
\gamma_x [n] = \sum_{k = 0} ^{\mathtt{length} (x)} x[k]x[k+n]
\end{equation}

\begin{figure}[h!]
	\centering
	\includegraphics{images/autocorr.eps}
	\caption{Comparatif de de la fonction xcorr et de notre implémentation de l'autocorrélation.}
	\label{autocorr}
\end{figure}

La figure \ref{autocorr} montre que le résultat de \verb`xcorr` et de notre implémentation de l'autocorrélation sont identiques.

\paragraph{Remarque}
Nous n'avions d'abord tracé que la partie positive, avant de nous rendre compte de la nécessité de tracer également la partie négative.
On obtient un résultat différent du résultat théorique car le support de notre signal est fini, ce qui donne un cosinus amorti de manière symétrique et non un simple cosinus.

\section{ Application à la classification de quelques signaux simples}

Lorsque le signal se "répète" au cours du temps son autocorrélation est semblable sur de courtes périodes (reproduction du même motif au cours des périodes), on dit alors que le signal est stationnaire. Par contre si son autocorrélation est presque nulle, cela veut dire qu'il n'y a pas reproduction des motifs au cour des périodes et donc que le signal est non stationnaire.

\begin{figure}[h!]
	\centering
	\includegraphics[width=1\textwidth]{images/classificationSig.eps}
	\caption{Autocorrélation de plusieurs signaux.}
	\label{classifSig}
\end{figure}

La figure \ref{classifSig} montre que les signaux sinusoïdaux et triangulaires sont stationnaires, contrairement au signal du bruit.

\begin{figure}[h!]
\centering
%\includegraphics[width=\textwidth]{images/classificationAh.eps}
\input{images/classificationAh.tex}
\caption{Autocorrélation de divers échantillons du signal vocal.}
\label{classifAh}
\end{figure}

La figure \ref{classifAh} montre que le signal vocal est quasi-stationnaire. En effet, sur de courtes périodes, son autocoorélation varie peu. ces résultats vont nous permettre dans la section suivante de séparer les différentes composantes d'un signal vocal. En effet, celles constituées essentiellement de bruit présenterons une autocorrélation très faible devant celles des parties voisées.

\FloatBarrier

\section{ Classification de signaux de parole voisés ou non voisés}

\label{sect:autocorr_voise}

D'après les résultats de la section précédente, on peut différencier un signal de parole voisé d'un non voisé en visualisant l'autocorrélation. En effet un signal non voisé est constitué de bruit et devrait présenter une autocorrélation faible, et non périodique. Se pose alors la question de la longueur des échantillons sur lesquels on calcule l'autocorrélation. Nous avons essayé les durées 0.01, 0.06, 0.16 et 0.64 secondes.

\begin{figure}[h!]
\centering
\includegraphics[height=0.45\textheight]{images/classificationVoix1.eps}
\caption{Autocorrélation de divers échantillons du signal vocal.}
\label{classif1}
\end{figure}

La figure \ref{classif1} montre que des échantillons de durée 0.01 secondes sont trop courts pour différencier aisément le signal voisé du non voisé.

\begin{figure}[h!]
\centering
\includegraphics[height=0.45\textheight]{images/classificationVoix4.eps}
\caption{Autocorrélation de divers échantillons du signal vocal.}
\label{classif4}
\end{figure}

La figure \ref{classif4} montre que des échantillons de durée 0.64 secondes sont trop longs. En effet, on se rapproche alors de la période de variation du signal liée au sens de la parole (visible sur l'échantillon pris entre 2 et 2.8 secondes par exemple).


Finalement,  on choisit une durée d'échantillon de 0.16 secondes (figure \ref{classif3}), car bien que celle de 0.06 convienne également pour différencier le signal voisé du non voisé, l'autocorrélation sur une plus grande période fait apparaître plus de maximums locaux, ce qui permet d'estimmer plus précisément la fréquence fondamentale du signal voisé. On trouve ainsi une fréquence du fondamental de 100 Hz environ.

\begin{figure}[h!]
	\centering
	\includegraphics[width=\textwidth]{images/classificationVoix3.eps}
	\caption{Autocorrélation de divers échantillons du signal vocal.}
	\label{classif3}
\end{figure}

\FloatBarrier
\newpage

\part{Aspects fréquentiels}

\section{Échantillonnage}
On réalise l'échantillonage d'un même signal de fréquence $f=500 \; Hz$ échantillonné à plusieurs fréquences différentes, le résultat obtenu est représenté dans les figures \ref{fig:echantillon1}, \ref{fig:echantillon2} et \ref{fig:echantillon3}.

\begin{figure}[h!]
	\centering
	\begin{minipage}{0.45\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/echantillone_1.eps}
	\caption{Signal échantilloné à $2f+1$.}
	\label{fig:echantillon1}

	\end{minipage}
	\begin{minipage}{0.45\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/echantillone_2.eps}
	\caption{Signal échantilloné à $40f$.}
	\label{fig:echantillon2}
	\end{minipage}
	\begin{minipage}{0.5\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/echantillone_3.eps}
	\caption{Signal échantilloné à $\frac{1}{2}f$.}
	\label{fig:echantillon3}
	\end{minipage}
\end{figure}

\FloatBarrier
\section{La Transformée de Fourier discrète (TFD)}

\subsection{Densité spectrale d'énergie}
On trace la densité spectrale d'énergie d'un signal voisé (figure \ref{fig:dse_vois}) et d'un signal non-voisé (figure \ref{fig:dse_nonvois}). On remarque que le signal non voisé ("ch") comporte de l'énergie dans toutes les fréquences de manière identique, tandis que le signal voisé ("a") présente de l'énergie uniquement sur certaines fréquences, ce qui est cohérent avec les résultats obtenus précédemment avec la méthode temporelle. %TODO : Pourquoi c'est cohérent ?


\begin{figure}[h!]
	\centering
	\begin{minipage}{0.45\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/tfd_voise.eps}
	\caption{Signal voisé et \bsc{dse}}
	\label{fig:dse_vois}
	\end{minipage}
	\begin{minipage}{0.45\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/tfd_nonvoise.eps}
	\caption{Signal non-voisé et \bsc{dse}}
	\label{fig:dse_nonvois}
	\end{minipage}
\end{figure}



\FloatBarrier
\subsection{Zéro-padding}
\begin{figure}[h!]
	\centering
	\includegraphics[width=\textwidth]{images/comp_0_padding.eps}
	\caption{Comparaison de la \bsc{dse} avec ou sans 0-padding}
	\label{fig:dse_0_padding}
\end{figure}
On réalise ensuite une fonction de 0-padding. On compare la DSE pour un signal voisé, on se rend compte d'une amélioration de la précision spectrale sans modifier la résolution (l'ajout de zéro n'ajoute pas d'informations dans le spectre, le nombre de point utile reste le même).


\FloatBarrier
\subsection{Réduction/élévation de cadence}

\begin{figure}[h!]
	\centering
	\includegraphics[width=\textwidth]{images/cadence_signal.eps}
	\caption{Signal échantillonné à 16kHz}
	\label{fig:cadence_signal}
\end{figure}

On reprend notre signal ("a") (figure \ref{fig:cadence_signal}) pour évaluer l'influence de l'élévation et de la réduction de cadence.
L'élévation de cadence (figure \ref{fig:élévation}) amène à une fréquence d'échantillonage plus élevée en insérant des zéros entre les intervalles temporels ce qui ajoute des composantes plus aigües à notre signal. La réduction de cadence (figure \ref{fig:réduction}) quant à elle supprime des échantillons et il est possible de ne plus respecter le critère de Shanon, impliquant du repliement spectrale perceptible au travers d'un son en général plus grave.

La fonction 'resample' applqiue un filtre passe bas de manière à supprimer les composantes parasites, le bruit qu'on a en augmentant, diminiuant la cadence ce qui explique pourquoi on a un résultat moins bruité.

\begin{figure}[h!]
\begin{minipage}{0.5\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/cadence_augmente.eps}
	\caption{Elevation de cadence}
	\label{fig:élévation}
\end{minipage}
\begin{minipage}{0.5\textwidth}
	\centering
	\includegraphics[width=\textwidth]{images/cadence_diminue.eps}
	\caption{Réduction de cadence}
	\label{fig:réduction}
\end{minipage}
\end{figure}

\FloatBarrier
\section{Analyse Spectrale}
\subsection{Analyse d'une tranche de signal par TFD}

La figure \ref{fig:hanning} montre qu'en réalisant la transformée de Fourier de la fenêtre de Hanning, on obtient un triangle de largeur $4/N$
  
\begin{figure}[h!]
	\centering
	%\includegraphics[width=\textwidth]{images/hanning_tfd.eps}
	\input{images/hanning_tfd.tex}
	\caption{TFD d'une fenêtre de Hanning}
	\label{fig:hanning}
\end{figure}

On remarque grâce à la figure \ref{fig:hanning_sans_0p} que du fait de l'échantillonage de la transformée de Fourier, le second pic du graphe est tronqué. On retrouve ainsi le résultat du TD 4.

\begin{figure}[h!]
	\centering
	%\includegraphics[width=\textwidth]{images/hanning_sans_0p.eps}
	\input{images/hanning_sans_0p.tex}
	\caption{Analyse d'une somme de cosinus}
	\label{fig:hanning_sans_0p}
\end{figure}

\subsection{Effets de quelques fenêtres}

Après modification de la fonction d'analyse (voir le fichier \verb`tfd.m`) pour permettre à l'utilisateur de choisir la fenêtre de pondération. On remarque tout d'abord que le 0-padding permet d'augmenter la résolution de la transformée de Fourier discrète. C'est pourquoi on comparera les effets des différentes fenêtres avec un 0-padding de 2048 points.

  
\begin{figure}[h!]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		%\includegraphics[width=\textwidth]{images/signal_fenetre.eps}
		\input{images/signal_fenetre.tex}
		\caption{Signal analysé.}
		\label{fig:fen_signal}
	\end{minipage}
\end{figure}
\begin{figure}[h!]
  	\begin{minipage}{\textwidth}
  		\centering
  		%\includegraphics[width=\textwidth]{images/rectangle.eps}
  		\input{images/rectangle.tex}
  		\caption{Effet du fenêtrage rectangulaire.}
  		\label{fig:fen_rectangle}
  	\end{minipage}
  	\begin{minipage}{\textwidth}
  		\centering
  		%\includegraphics[width=\textwidth]{images/hanning.eps}
  		\input{images/hanning.tex}
  		\caption{Effet du fenêtrage de Hanning}
  		\label{fig:fen_hanning}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\centering
		%\includegraphics[width=\textwidth]{images/hamming.eps}
		\input{images/hamming.tex}
		\caption{Effet du fenêtrage de Hamming}
		\label{fig:fen_hamming}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\centering
		% \incudegraphics[width=\textwidth]{images/blackman.eps}
		\input{images/blackman.tex}
		\caption{Effet du fenêtrage de Blackman}
		\label{fig:fen_blackman}
	\end{minipage}
\end{figure}

On remarque que le fenêtrage rectanglaire (figure \ref{fig:fen_rectangle}), s'il produit des pics de faible largeure devant ceux des autres fenêtres produit des lobes secondaires de hauteur importante. Les fenêtres de Hanning (figure \ref{fig:fen_hanning}), puis de Hamming (figure \ref{fig:fen_hamming}) et de Blackman (figure \ref{fig:fen_blackman}) produisent des lobes secondaires de hauteur de plus en plus faibles, mais au détriment de la largeure du lobe principal.

\FloatBarrier
\clearpage
\part{Application : détection de pitch}

Le but de cette partie est de réaliser une fonction capable de détecter la note jouée lors d'un enregistrement sonore. Pour cela on va découper le signal en tranches réparties régulièrement sur toute la durée de l'enregistrement.

\section{Détection de signal voisé}

Dans un premier temps il est nécessaire de pouvoir différencier une tranche de signal voisée d'une tranche non voisée. Nous avons vu dans la section \ref{sect:autocorr_voise} que nous pouvons classifier le signal en utilisant l'autocorrélation. On remarque qu'un signal périodique que l'on pondère par une fenêtre rectangulaire de largeure $T$ possède une autocorrélation comprise dans une enveloppe triangulaire telle que décrite par la figure \ref{fig:enveloppe}.

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}
	\draw[->] (-4,0) -- (0,0) node[anchor=north west]{0} -- (4,0) node[anchor=north west] {$\tau$};
	\draw[->] (0,-0.5) -- (0,3);% node[anchor=south]{Enveloppe};
	
	\draw[red,thick,dashed] (-3.5,0)  -- (0,2.5) -- (3.5, 0);
	
	\draw (-3.5,0.1) -- (-3.5,-0.1) node[anchor=north]{$-T$};
	\draw (3.5,0.1) -- (3.5,-0.1) node[anchor=north]{$T$};
	\draw (-0.1,2.5) -- (0.1, 2.5) node[anchor=south west]{$E$};
	
	\draw (1.5,1.5) node[anchor=south west]{$\tau \mapsto \frac{E}{T}(T - \tau)$};
	\draw (-1.5,1.5) node[anchor=south east]{$\tau \mapsto \frac{E}{T}(T + \tau )$};
	
	\end{tikzpicture}
	\caption[Enveloppe de l'autocorrélation]{Enveloppe du signal de l'autocorrélation pour un signal périodique pondéré par une fenêtre rectangulaire de largeure T}
	\label{fig:enveloppe}
\end{figure}

Afin de détecter la pseudo-périodicité dans l'autocorrélation, et donc la nature voisée du signal, on va chercher des maximums locaux dont la distance au triangle est faible. De plus ces maximums devront satisfaire un critère de périodicité, c'est à dire que si $k$ est l'indice d'un tel maximum local, l'ensemble des $\{nk, nk \leq T\}$ doivent également correspondre à des points de l'autocorrélation proches du triangle. De plus, l'autocorrélation étant paire, on ne regardera que les $k$ positifs.

\section{Mesure du pitch}

La mesure du pitch est nécessaire à la détermination de la note. Cela se fait également sur l'autocorrélation, en mesurant la période des maximums locaux qui déterminent si le signal est voisé. On modifie donc la fonction écrite dans la section précédente afin de prendre en argument la plage de recherche du pitch (ce qui va également accélérer l'exécution de la fonction). 

On renvoie un booléen qui indique si le signal est voisé, et l'indice du maximum qui a permis de déterminer ce résultat. Si on appelle $k$ l'indice ainsi obtenu, l'utilisateur peut déterminer la fréquence du fondamental $f$ avec $f = \frac{f_e}{k}$ où $f_e$ est la fréquence d'échantillonage du signal.

\section{Détection de la note}

La formule donnée par le sujet du TL relie le numéro de la note à la fréquence du fondamental associé.

\begin{equation}
f = 440 \times 2 ^{\frac{n - 69}{12}}
\label{eq:freq_note}
\end{equation}

Il suffit donc d'inverser l'équation \ref{eq:freq_note} pour obtenir le numéro de la note en fonction de la fréquence mesurée sur le signal. La note obtenue n'étant pas forcément juste, il faut adapter un peu pour obtenir un nombre entier à coup sûr.

\begin{equation}
n = \lfloor 12 \times \log_2\left(\frac{f}{440}\right) + 69 \rfloor
\end{equation}

\end{document}
